name: Cypress

on: push

jobs:
  cypress:
    runs-on: ubuntu-latest
    if: "!contains(github.event.head_commit.message, 'chore(release): version packages')"

    steps:
      - name: Checkout Repo
        uses: actions/checkout@v2

      - name: Cypress run
        uses: cypress-io/github-action@v2
        env:
          CYPRESS_RECORD_KEY: ${{ secrets.CYPRESS_RECORD_KEY }}
          AIRTABLE_APIKEY: ${{ secrets.AIRTABLE_APIKEY }}
          AIRTABLE_BASEID: ${{ secrets.AIRTABLE_BASEID }}
          GATSBY_DOCSEARCH_APIKEY: ${{ secrets.GATSBY_DOCSEARCH_APIKEY }}
        with:
          browser: chrome
          start: yarn build && yarn build:website && yarn serve:website
          # quote the url to be safe against YML parsing surprises
          wait-on: "http://localhost:9000"
