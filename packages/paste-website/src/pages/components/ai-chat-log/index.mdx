export const meta = {
  title: "AI Chat Log - Components",
  package: "@twilio-paste/ai-chat-log",
  description:
    "An AI Chat Log is a collection of AI Chat components for displaying conversations between a human and an AI bot.",
  slug: "/components/ai-chat-log/",
};

import { Anchor } from "@twilio-paste/anchor";
import { Avatar } from "@twilio-paste/avatar";
import { Box } from "@twilio-paste/box";
import { uid } from "@twilio-paste/uid-library";
import {
  ChatAttachment,
  ChatAttachmentDescription,
  ChatAttachmentLink,
  ChatBookend,
  ChatBookendItem,
  ChatBubble,
  ChatEvent,
  ChatLog,
  ChatMessage,
  ChatMessageMeta,
  ChatMessageMetaItem,
  useChatLogger,
  ChatLogger,
} from "@twilio-paste/chat-log";
import {
  AIChatLog,
  AIChatMessage,
  AIChatMessageAuthor,
  AIChatMessageBody,
  AIChatMessageFeedback,
  AIChatMessageLoading,
  AIChatLogger,
  useAIChatLogger,
  AIChatMessageActions
} from "@twilio-paste/core/ai-chat-log";

import Changelog from "@twilio-paste/ai-chat-log/CHANGELOG.md";
import { DownloadIcon } from "@twilio-paste/icons/esm/DownloadIcon";
import { HelpText } from "@twilio-paste/help-text";
import { Callout, CalloutHeading, CalloutText } from "@twilio-paste/callout";
import { Button } from "@twilio-paste/button";
import { ButtonGroup } from "@twilio-paste/button-group";
import { Stack } from "@twilio-paste/stack";

import { SidebarCategoryRoutes } from "../../../constants";
import {
  inboundMessageMeta,
  outboundMessageMeta,
  inboundMessageAttachment,
  outboundMessageAttachment,
  inboundComplexMessage,
  outboundComplexMessage,
  basicChatEvent,
  basicChatBookend,
  chatLoggerExample,
} from "../../../component-examples/ChatLogExamples.ts";

import {
  basicBotMessage,
  basicHumanMessage,
  botWithFeedback,
  botWithActionButtons,
  botWithLoadingStopButton,
  botWithLoading,
  kitchenSink,
  aiChatLoggerExample,
} from "../../../component-examples/AIChatLogExamples";
import packageJson from "@twilio-paste/ai-chat-log/package.json";
import ComponentPageLayout from "../../../layouts/ComponentPageLayout";
import { getFeature, getNavigationData } from "../../../utils/api";

export default ComponentPageLayout;

export const getStaticProps = async () => {
  const navigationData = await getNavigationData();
  const feature = await getFeature("AI Chat Log");
  return {
    props: {
      data: {
        ...packageJson,
        ...feature,
      },
      navigationData,
      mdxHeadings,
      pageHeaderData: {
        categoryRoute: SidebarCategoryRoutes.COMPONENTS,
        githubUrl: "https://github.com/twilio-labs/paste/tree/main/packages/paste-core/components/ai-chat-log",
        storybookUrl: "/?path=/story/components-chatlog--example-chat-log",
      },
    },
  };
};

<LivePreview
  scope={{
    AIChatLog,
    AIChatMessage,
    AIChatMessageAuthor,
    AIChatMessageBody,
  }}
  language="jsx"
>
  {`<AIChatLog>
  <AIChatMessage variant="user">
    <AIChatMessageAuthor aria-label="You said at 2:36pm">Gibby Radki</AIChatMessageAuthor>
    <AIChatMessageBody>
      What does the SMS delivery error code 30003 mean?
    </AIChatMessageBody>
  </AIChatMessage>
  <AIChatMessage variant="bot">
    <AIChatMessageAuthor aria-label="AI said">Good Bot</AIChatMessageAuthor>
    <AIChatMessageBody>
      Here is what I found, error code 30003 means: The destination phone is unavailable or turned off, or it may be a landline or phone that doesn't support SMS.
    </AIChatMessageBody>
  </AIChatMessage>
</AIChatLog>`}
</LivePreview>

## Guidelines

### About AI Chat Log

An AI Chat Log is a way to display conversations between a user and AI.

The AI Chat Log package includes these main components:

- AIChatLog
- AIChatMessage
- AIChatMessageAuthor
- AIChatMessageBody
- AIChatMessageActions
- AIChatMessageFeedback
- AIChatMessageLoading

### Accessibility

To ensure the chat is accessible, only use the AI Chat components within an AIChatLog component and use AIChatMessage to wrap AIChatMessageBody, AIChatMessageActions and AIChatMessageFeedback components together.

The only other accessibility requirement is providing the AIChatMessageActions a descriptive label via the `aria-label` React prop.

The AIChatLog component has `role=”log”` which means that any new messages added to it are announced by assistive technology.

## Examples

### Basic Message

A message must include the author and body. Any message text from a user or a bot must be contained within the AIChatMessageBody component. Due to lengthy AI responses, the chat layout is now top-down

#### Bot

<LivePreview
  scope={{
    AIChatLog,
    AIChatMessage,
    AIChatMessageAuthor,
    AIChatMessageBody,
  }}
  language="jsx"
  noInline
>
  {basicBotMessage}
</LivePreview>

#### User

<LivePreview
  scope={{
    AIChatLog,
    AIChatMessage,
    AIChatMessageAuthor,
    AIChatMessageBody,
  }}
  language="jsx"
  noInline
>
  {basicHumanMessage}
</LivePreview>

### Message Body Variants

The AIChatMessageBody component has two variants, `default` and `fullscreen`. The `fullscreen` variant is used where the ChatLog is displayed in the full width of the page where larger font size is needed.

#### Default

<LivePreview
  scope={{
    AIChatLog,
    AIChatMessage,
    AIChatMessageAuthor,
    AIChatMessageBody,
  }}
  language="jsx"
>
  {`<AIChatLog>
  <AIChatMessage variant="user">
    <AIChatMessageAuthor aria-label="You said at 2:36pm">Gibby Radki</AIChatMessageAuthor>
    <AIChatMessageBody variant="default">
      What does the SMS delivery error code 30003 mean?
    </AIChatMessageBody>
  </AIChatMessage>
</AIChatLog>`}
</LivePreview>

#### Fullscreen

<LivePreview
  scope={{
    AIChatLog,
    AIChatMessage,
    AIChatMessageAuthor,
    AIChatMessageBody,
  }}
  language="jsx"
>
  {`<AIChatLog>
  <AIChatMessage variant="user">
    <AIChatMessageAuthor aria-label="You said at 2:36pm">Gibby Radki</AIChatMessageAuthor>
    <AIChatMessageBody variant="fullScreen">
      What does the SMS delivery error code 30003 mean?
    </AIChatMessageBody>
  </AIChatMessage>
</AIChatLog>`}
</LivePreview>

### Message with Actions

Use AIChatMessageActions to append additional information to a message such as AIChatMessageFeedback or custom action buttons .

AIChatMessageActions should be a child of AIChatMessage so that the text and meta information are correctly grouped together for assistive technologies. It also needs a readable `aria-label` that summarizes what the meta information says.

#### Action Buttons

<LivePreview
  scope={{
    AIChatLog,
    AIChatMessage,
    AIChatMessageAuthor,
    AIChatMessageBody,
    AIChatMessageActions,
    ButtonGroup,
    Button,
  }}
  language="jsx"
  noInline
>
  {botWithActionButtons}
</LivePreview>

#### Feedback

<LivePreview
  scope={{
    AIChatLog,
    AIChatMessage,
    AIChatMessageAuthor,
    AIChatMessageBody,
    AIChatMessageFeedback,
    AIChatMessageActions,
  }}
  language="jsx"
  noInline
>
  {botWithFeedback}
</LivePreview>

#### Feedback Internationalization
The labels on feedback can be internationalized by passing using the `i18nDislikeLabel` and `i18nLikeLabel` to describe the feedback options.

<LivePreview
  scope={{
    AIChatMessageFeedback,
    AIChatMessageActions
  }}
  language="jsx"
>
  {`<AIChatMessageActions aria-label="Feedback form">
  <AIChatMessageFeedback
    label="Est-ce utile?"
    i18nDislikeLabel="pas aimer"
    i18nLikeLabel="aimer"
    onLike={() => {}}
    onDislike={() => {}}
  />
</AIChatMessageActions>`}
</LivePreview>


### Loading States

Use the AIChatMessageLoading component to indicate that the bot is typing or processing a response.

The SkeletonLoader lengths vary on each render to give a more natural pending message body interaction.

#### Loading

<LivePreview
  scope={{
    AIChatLog,
    AIChatMessage,
    AIChatMessageAuthor,
    AIChatMessageBody,
    AIChatMessageActions,
    AIChatMessageLoading,
  }}
  language="jsx"
  noInline
>
  {botWithLoading}
</LivePreview>

#### Loading with Stop Button

<LivePreview
  scope={{
    AIChatLog,
    AIChatMessage,
    AIChatMessageAuthor,
    AIChatMessageBody,
    AIChatMessageActions,
    AIChatMessageLoading,
  }}
  language="jsx"
  noInline
>
  {botWithLoadingStopButton}
</LivePreview>

### Example AI Chat Log

This example combines all the separate features displayed previously into one example. It shows how all the features work together harmoniously through composition.

<LivePreview
  scope={{
    AIChatLog,
    AIChatMessage,
    AIChatMessageAuthor,
    AIChatMessageBody,
    AIChatMessageFeedback,
    AIChatMessageLoading,
    AIChatMessageActions,
    Button,
    ButtonGroup,
  }}
  language="jsx"
  noInline
>
  {kitchenSink}
</LivePreview>

### useAIChatLogger hook

The `useAIChatLogger` hook provides a hook based approach to managing AI chat state. It is best used with the `<AIChatLogger />` component.

`useAIChatLogger` returns 4 things:

- An array of `aiChats`.
- A `push` method used to add a chat, optionally with a custom ID
- A `pop` method used to remove a chat, optionally via its ID.
- A `clear` method used to remove all chats.

##### AIChatLogger component

The `<AIChatLogger />` component handles rendering the chats it is passed via props. It handles how chats enter and leave the UI.

```
const { aiChats }= useAIChatLogger();
return <AIChatLogger aiChats={aiChats} />;
```

##### Adding and removing a chat

You can push or pop a chat based on an action or event. In this example it's based on a button click:

<LivePreview
  scope={{
    AIChatMessage,
    AIChatMessageAuthor,
    AIChatMessageBody,
    AIChatMessageFeedback,
    AIChatMessageLoading,
    AIChatMessageActions,
    Button,
    ButtonGroup,
    useAIChatLogger,
    AIChatLogger,
    Stack,
    uid
  }}
  language="jsx"
  noInline
>
  {aiChatLoggerExample}
</LivePreview>

## Composition Notes

Keep content as concise as possible given the space constraints.


### AI Chat Log vs Chat Log

The main difference between AI chat Log and Chat Log is ...


### Error messages

To convey an error related to whether a message was sent, use Help Text inside the Message Meta. Limit the message to a single sentence and focus on how the user can resolve the issue. Offer a [link-style retry button](/components/button#link-style-button) when applicable.

To convey an error related to other actions taken in the Chat Log, like a file upload validation error, use a [Toast](/components/toast) at the top of the individual chat window.

To convey an error that applies to the whole page, not just a particular Chat Log, use a page-level [Callout or Alert](/patterns/error-state#when-to-use-which-component).
